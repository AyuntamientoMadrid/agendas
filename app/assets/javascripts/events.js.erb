$(function(){
  $('.fdatepicker').fdatepicker({
    format: "<%= I18n.translate('datepicker-format-time') %>",
    pickTime: true,
    language: "<%= I18n.locale %>",
    disableDblClickSelection: true,
    weekStart: 1
  });

  $(".admin-form").validate({
      ignore: [],
      errorElement: "small",
      rules : {
          "event[title]" : {
              required : true
          },
          "event[scheduled]" : {
              required : true
          },
          "event[position_id]" : {
              required : true
          }
      },

      messages : {
          "event[title]" : {
              required : "<%= I18n.translate('backend.mandatory_field')%>"
          },
          "event[scheduled]" : {
              required : "<%= I18n.translate('backend.mandatory_field')%>"
          },
          "event[position_id]" : {
              required : "<%= I18n.translate('backend.mandatory_field')%>"
          }
      },

      errorPlacement : function(error, element) {
          error.insertAfter(element);
      }
  });

  $("#event_lobby_activity_true").click(function(){
    $("#lobby-activity-event").show();
  });
  $("#event_lobby_activity_false").click(function(){
    $("#lobby-activity-event").hide();
  });
  $('#search-organization').bind('railsAutocomplete.select', function(event, data){
    $('#event_organization_id').val(data.item.id)
  });

  $('#search-organization').change(function(){
    if ($('#event_organization_id').val()){
      $.ajax({
        method: "GET",
        url: $('#lobby-activity-event').data('new-url').replace('organization_id', $('#event_organization_id').val())
      }).done(function( represented_entities ) {
        var check_box_container = $('#yeah');
        $.each(represented_entities, function(id, represented_entity){
          check_box_container.append($('<input>', { type:"checkbox", value: represented_entity.id, id: "represented_entity_event_ids_"+represented_entity.id, name: "event[represented_entity_ids][]"}));
          check_box_container.append($('<span>').text(represented_entity.name));
        });
      });
    }
  });

});
